<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Valentine's Block Blast - For Sara</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Arial', sans-serif;
      background: #ffe6f0;
      color: #d63384;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
    }
    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background-color: #fff0f5;
      border: 4px solid #d63384;
    }
    .pieces {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .piece {
      margin: 0 10px;
      cursor: grab;
      display: inline-block;
    }
    .cell {
      width: 60px;
      height: 60px;
      background-color: #ff4d88;
      margin: 1px;
      display: inline-block;
      border-radius: 4px;
      text-align: center;
      line-height: 60px;
      font-size: 48px;
      color: white;
      transition: transform 0.2s ease;
    }
    .sidebar {
      width: 200px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .score-box {
      padding: 10px;
      border: 2px solid #d63384;
      background: #fff0f5;
      border-radius: 10px;
    }
    .restart-btn {
      display: none;
      padding: 10px 20px;
      font-size: 1.1rem;
      border: none;
      background-color: #ff4d88;
      color: white;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>For Sara üíñ</h1>
    <canvas id="gameCanvas" width="480" height="480"></canvas>
    <div class="pieces" id="pieces"></div>
<script>
let dragPieceIndex = null;

function generatePieces() {
  const container = document.getElementById("pieces");
  container.innerHTML = "";
  currentPieces = [];

  for (let i = 0; i < 3; i++) {
    const shape = shapes[Math.floor(Math.random() * shapes.length)];
    const block = randomBlock();
    currentPieces.push({ shape, block });

    const div = document.createElement("div");
    div.className = "piece";
    div.draggable = true;
    div.dataset.index = i;
    shape.forEach((row) => {
      const rowDiv = document.createElement("div");
      row.forEach((cell) => {
        const cellDiv = document.createElement("div");
        cellDiv.className = "cell";
        cellDiv.textContent = cell ? block.icon : "";
        cellDiv.style.backgroundColor = cell ? block.color : "transparent";
        rowDiv.appendChild(cellDiv);
      });
      div.appendChild(rowDiv);
    });
    container.appendChild(div);
  }

  document.querySelectorAll(".piece").forEach((piece) => {
    piece.addEventListener("dragstart", (e) => {
      dragPieceIndex = parseInt(e.currentTarget.dataset.index);
      e.dataTransfer.setData("text/plain", dragPieceIndex);
    });
  });
}
</script>
  </div>
  <div class="sidebar">
    <div class="score-box">
      <div>Score: <span id="score">0</span></div>
      <div>Level: <span id="level">1</span></div>
      <div>Goal: <span id="goal">100</span></div>
    </div>
    <button id="restartBtn" class="restart-btn">Restart üîÅ</button>
    <div class="message" id="messageBox">You are so stunning, my love üíó</div>
  </div>
<script>
let score = 0;
let level = 1;
let goal = 100;

const scoreDisplay = document.getElementById("score");
const levelDisplay = document.getElementById("level");
const goalDisplay = document.getElementById("goal");
const restartBtn = document.getElementById("restartBtn");

function updateScoreDisplay() {
  scoreDisplay.textContent = score;
  levelDisplay.textContent = level;
  goalDisplay.textContent = goal;
}

function checkGameOver() {
  let hasMove = false;
  currentPieces.forEach(({ shape }) => {
    for (let gy = 0; gy <= 8 - shape.length; gy++) {
      for (let gx = 0; gx <= 8 - shape[0].length; gx++) {
        let fits = true;
        for (let y = 0; y < shape.length; y++) {
          for (let x = 0; x < shape[0].length; x++) {
            if (shape[y][x] && grid[gy + y][gx + x]) fits = false;
          }
        }
        if (fits) hasMove = true;
      }
    }
  });
  if (!hasMove) restartBtn.style.display = "inline-block";
}

restartBtn.onclick = () => {
  grid = Array.from({ length: 8 }, () => Array(8).fill(null));
  drawGrid();
  generatePieces();
  showMessage();
  score = 0;
  level = 1;
  goal = 100;
  updateScoreDisplay();
  restartBtn.style.display = "none";
};
function placePiece(piece, gx, gy) {
  const shape = piece.shape;
  let placedAny = false;
  for (let y = 0; y < shape.length; y++) {
    for (let x = 0; x < shape[y].length; x++) {
      if (shape[y][x]) {
        const px = gx + x;
        const py = gy + y;
        if (px < 0 || px >= 8 || py < 0 || py >= 8 || grid[py][px]) {
          return false;
        }
      }
    }
  }
  for (let y = 0; y < shape.length; y++) {
    for (let x = 0; x < shape[y].length; x++) {
      if (shape[y][x]) {
        const px = gx + x;
        const py = gy + y;
        grid[py][px] = { ...piece.block };
        placedAny = true;

        const highlight = document.createElement('div');
        highlight.className = 'cell placed';
        highlight.style.position = 'absolute';
        highlight.style.left = `${canvas.offsetLeft + px * 60}px`;
        highlight.style.top = `${canvas.offsetTop + py * 60}px`;
        highlight.style.width = `60px`;
        highlight.style.height = `60px`;
        highlight.style.backgroundColor = piece.block.color;
        highlight.style.color = 'white';
        highlight.style.lineHeight = `60px`;
        highlight.textContent = piece.block.icon;
        highlight.style.fontSize = '42px';
        highlight.style.zIndex = 100;
        highlight.style.animation = 'popIn 0.3s ease-out';
        document.body.appendChild(highlight);
        setTimeout(() => highlight.remove(), 300);
      }
    }
  }
  return placedAny;
}

function checkAndClearLines() {
  let clearedBlocks = 0;

  for (let y = 0; y < 8; y++) {
    if (grid[y].every(cell => cell)) {
      grid[y] = Array(8).fill(null);
      clearedBlocks += 8;
    }
  }

  for (let x = 0; x < 8; x++) {
    let colFull = true;
    for (let y = 0; y < 8; y++) {
      if (!grid[y][x]) colFull = false;
    }
    if (colFull) {
      for (let y = 0; y < 8; y++) grid[y][x] = null;
      clearedBlocks += 8;
    }
  }

  if (clearedBlocks > 0) {
    const centerX = canvas.offsetLeft + canvas.width / 2;
    createHeartBurst(centerX, window.innerHeight);
    score += clearedBlocks;
    updateScoreDisplay();
    if (score >= goal) {
      level += 1;
      goal = 100 + level * 50;
      updateScoreDisplay();
    }
  }

  checkGameOver();
}
function showConfetti() {
  for (let i = 0; i < 40; i++) {
    const heart = document.createElement('div');
    heart.textContent = 'üíñ';
    heart.style.position = 'fixed';
    heart.style.left = `${Math.random() * 100}%`;
    heart.style.top = '100%';
    heart.style.fontSize = `${Math.random() * 20 + 20}px`;
    heart.style.animation = `floatConfetti ${Math.random() * 2 + 2}s ease-out forwards`;
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 4000);
  }
}

const confettiStyle = document.createElement('style');
confettiStyle.textContent = `
@keyframes floatConfetti {
  0% {
    transform: translateY(0);
    opacity: 1;
  }
  100% {
    transform: translateY(-100vh);
    opacity: 0;
  }
}`;
document.head.appendChild(confettiStyle);

function checkAndClearLines() {
  let clearedBlocks = 0;

  for (let y = 0; y < 8; y++) {
    if (grid[y].every(cell => cell)) {
      grid[y] = Array(8).fill(null);
      clearedBlocks += 8;
    }
  }

  for (let x = 0; x < 8; x++) {
    let colFull = true;
    for (let y = 0; y < 8; y++) {
      if (!grid[y][x]) colFull = false;
    }
    if (colFull) {
      for (let y = 0; y < 8; y++) grid[y][x] = null;
      clearedBlocks += 8;
    }
  }

  if (clearedBlocks > 0) {
    const centerX = canvas.offsetLeft + canvas.width / 2;
    createHeartBurst(centerX, window.innerHeight);
    score += clearedBlocks;
    updateScoreDisplay();
    if (score >= goal) {
      level += 1;
      goal = 100 + level * 50;
      updateScoreDisplay();
      showConfetti();
    }
  }

  checkGameOver();
}
</script>
</body>
</html>
